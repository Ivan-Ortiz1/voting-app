<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Tema</title>
  <link rel="stylesheet" href="/css/estilos.css">
</head>
<body>
  <h1>Editar Tema</h1>

  <!-- Mensaje de error si existe -->
  <% if (typeof error !== "undefined") { %>
    <p style="color:red;"><%= error %></p>
  <% } %>

  <!-- Formulario para editar el título del tema -->
  <form action="/temas/editar/<%= tema.id %>" method="POST">
    <input type="text" name="titulo" value="<%= tema.titulo %>" required>
    <button type="submit">Guardar cambios</button>
  </form>

  <h2>Enlaces</h2>

  <!-- Formulario para agregar enlaces -->
  <form action="/temas/editar/<%= tema.id %>/enlaces/agregar" method="POST">
    <input type="text" name="nombre" placeholder="Ej: Documentación oficial de Express" required>
    <input type="url" name="url" placeholder="https://..." required>
    <button type="submit">Agregar Enlace</button>
  </form>

  <!-- Lista de enlaces existentes con edición inline -->
  <ul id="lista-enlaces">
    <% tema.enlaces.forEach(e => { %>
      <li id="enlace-<%= e.id %>" class="enlace-item">
        <!-- Edición inline vía AJAX -->
        <div class="form-editar-enlace">
          <input type="text" class="nombre-enlace" value="<%= e.nombre %>" required>
          <input type="url" class="url-enlace" value="<%= e.url %>" required>
          <button 
            type="button"
            class="btn-guardar-enlace"
            data-id="<%= e.id %>"
            data-tema="<%= tema.id %>">
            Guardar
          </button>
        </div>

        <!-- Contador de votos -->
        <span class="contador-votos"><%= e.votos %></span> votos

        <!-- Botón para eliminar enlace -->
        <form action="/temas/editar/<%= tema.id %>/enlaces/eliminar/<%= e.id %>" method="POST" style="display:inline;">
          <button>Eliminar</button>
        </form>

        <!-- Botón para votar enlace en tiempo real -->
        <button 
          class="btn-votar-enlace" 
          data-id="<%= e.id %>" 
          data-tema="<%= tema.id %>">
          Votar
        </button>
      </li>
    <% }) %>
  </ul>

  <p><a href="/temas">Volver a la lista</a></p>

  <!-- Scripts para interacción AJAX -->
  <script src="/js/votacionEnlaces.js"></script>
  <script src="/js/editarEnlaces.js"></script>
</body>
</html>
