<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Tema</title>
  <link rel="stylesheet" href="/css/estilos.css">
</head>
<body>
  <h1>Editar Tema</h1>

  <!-- Mensaje de error si existe -->
  <% if (typeof error !== "undefined") { %>
    <p style="color:red;"><%= error %></p>
  <% } %>

  <!-- Formulario para editar el título del tema -->
  <form action="/temas/editar/<%= tema.id %>" method="POST">
    <input type="text" name="titulo" value="<%= tema.titulo %>" required>
    <button type="submit">Guardar cambios</button>
  </form>

  <h2>Enlaces del tema "<%= tema.titulo %>"</h2>

  <!-- Formulario para agregar un nuevo enlace -->
  <form id="form-agregar-enlace" action="/temas/editar/<%= tema.id %>/enlaces/agregar" method="POST">
    <input type="text" name="nombre" placeholder="Nombre del enlace" required>
    <input type="url" name="url" placeholder="https://..." required>
    <button type="submit">Agregar enlace</button>
  </form>

  <!-- Lista de enlaces existentes con edición inline -->
  <ul id="lista-enlaces">
    <% tema.enlaces.forEach(e => { %>
      <li id="enlace-<%= e.id %>" class="enlace-item">
        <!-- Inputs editables -->
        <input type="text" class="nombre-enlace" value="<%= e.nombre %>" required>
        <input type="url" class="url-enlace" value="<%= e.url %>" required>

        <!-- Botón guardar inline -->
        <button 
          type="button"
          class="btn-guardar-enlace"
          data-tema="<%= tema.id %>"
          data-id="<%= e.id %>">
          Guardar
        </button>

        <!-- Contador de votos -->
        <span class="contador-votos"><%= e.votos %></span> votos

        <!-- Botón votar -->
        <button 
          type="button"
          class="btn-votar-enlace"
          data-tema="<%= tema.id %>"
          data-id="<%= e.id %>">
          Votar
        </button>

        <!-- Botón eliminar -->
        <form 
          action="/temas/editar/<%= tema.id %>/enlaces/eliminar/<%= e.id %>" 
          method="POST" 
          style="display:inline;">
          <button type="submit">Eliminar</button>
        </form>
      </li>
    <% }) %>
  </ul>

  <p><a href="/temas">Volver a la lista</a></p>

  <!-- Scripts para interacción AJAX y votación -->
  <script type="module" src="/js/enlacesAjax.js"></script>
  <script type="module" src="/js/utilidades.js"></script>
</body>
</html>
